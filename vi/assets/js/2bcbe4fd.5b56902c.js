"use strict";(self.webpackChunkhasura_extra_github_io=self.webpackChunkhasura_extra_github_io||[]).push([[419],{2352:function(t,a,n){n.r(a),n.d(a,{frontMatter:function(){return u},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return l},default:function(){return h}});var e=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],u={id:"laravel-sanctum-authentication",title:"Laravel Sanctum authentication",sidebar_label:"Laravel Sanctum authentication"},p=void 0,s={unversionedId:"security/laravel-sanctum-authentication",id:"security/laravel-sanctum-authentication",isDocsHomePage:!1,title:"Laravel Sanctum authentication",description:"T\xe0i li\u1ec7u n\xe0y ch\u1ec9 d\xe0nh cho Laravel users s\u1eed d\u1ee5ng webhook authentication.",source:"@site/i18n/vi/docusaurus-plugin-content-docs/current/05-security/05-laravel-sanctum-authentication.md",sourceDirName:"05-security",slug:"/security/laravel-sanctum-authentication",permalink:"/vi/security/laravel-sanctum-authentication",editUrl:"https://github.com/hasura-extra/hasura-extra/edit/main/docusaurus/i18n/vi/docusaurus-plugin-content-docs/current/05-security/05-laravel-sanctum-authentication.md",tags:[],version:"current",lastUpdatedBy:"Minh Vuong",lastUpdatedAt:1638641209,formattedLastUpdatedAt:"4/12/2021",sidebarPosition:5,frontMatter:{id:"laravel-sanctum-authentication",title:"Laravel Sanctum authentication",sidebar_label:"Laravel Sanctum authentication"},sidebar:"main",previous:{title:"Laravel access control",permalink:"/vi/security/laravel-access-control"},next:{title:"Symfony JWT authentication",permalink:"/vi/security/symfony-jwt-authentication"}},l=[{value:"Mobile app authentication",id:"mobile-app-authentication",children:[{value:"C\u1ea5u h\xecnh auth",id:"c\u1ea5u-h\xecnh-auth",children:[],level:3},{value:"Th\xeam login mutation",id:"th\xeam-login-mutation",children:[],level:3}],level:2}],c={toc:l};function h(t){var a=t.components,u=(0,i.Z)(t,r);return(0,o.kt)("wrapper",(0,e.Z)({},c,u,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"T\xe0i li\u1ec7u n\xe0y ch\u1ec9 d\xe0nh cho Laravel users s\u1eed d\u1ee5ng ",(0,o.kt)("a",{parentName:"p",href:"/vi/security/webhook-authentication"},"webhook authentication"),"."))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://laravel.com/docs/8.x/sanctum"},"Laravel Sanctum")," l\xe0 m\u1ed9t authentication system tuy\u1ec7t v\u1eddi v\xe0 \u0111\u01b0\u1ee3c c\xe0i \u0111\u1eb7t s\u1eb5n \u1edf c\xe1c\nkickstarter template c\u1ee7a Laravel, t\xe0i li\u1ec7u n\xe0y s\u1ebd h\u01b0\u1edbng d\u1eabn b\u1ea1n d\xf9ng Sanctum \u0111\u1ec3 l\xe0m authentication system cho Hasura. "),(0,o.kt)("h2",{id:"mobile-app-authentication"},"Mobile app authentication"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"N\u1ebfu nh\u01b0 project c\u1ee7a b\u1ea1n s\u1eed d\u1ee5ng ",(0,o.kt)("a",{parentName:"p",href:"/vi/installation/application-templates"},"Laravel app"),", template \u0111\xe3 setup m\u1ecdi th\u1ee9 gi\xfap b\u1ea1n,\nb\u1ea1n kh\xf4ng c\u1ea7n l\xe0m theo c\xe1c b\u01b0\u1edbc b\xean d\u01b0\u1edbi m\xe0 ch\u1ec9 n\xean \u0111\u1ecdc \u0111\u1ec3 hi\u1ec3u c\u01a1 ch\u1ebf ho\u1ea1t \u0111\u1ed9ng c\u1ee7a n\xf3 nh\u01b0 th\u1ebf n\xe0o."))),(0,o.kt)("h3",{id:"c\u1ea5u-h\xecnh-auth"},"C\u1ea5u h\xecnh auth"),(0,o.kt)("p",null,"B\u1ea1n c\u1ea7n thi\u1ebft l\u1eadp ",(0,o.kt)("inlineCode",{parentName:"p"},"defaults.guard")," trong ",(0,o.kt)("inlineCode",{parentName:"p"},"config/auth.php")," l\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"sanctum"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="config/auth.php"',title:'"config/auth.php"'},"'defaults' => [\n    'guard' => 'sanctum',\n],\n")),(0,o.kt)("p",null,"Trong tr\u01b0\u1eddng h\u1ee3p project c\u1ee7a b\u1ea1n c\xf3 multi guards v\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"defaults.guard")," kh\xf4ng th\u1ec3 l\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"sanctum")," th\xec b\u1ea1n h\xe3y th\xeam n\xf3 v\xe0o ",(0,o.kt)("inlineCode",{parentName:"p"},"auth.guard")," trong file ",(0,o.kt)("inlineCode",{parentName:"p"},"config/hasura.php"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="config/hasura.php"',title:'"config/hasura.php"'},"'auth' => [\n    'guard' => ['sanctum'],\n]\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"N\u1ebfu ",(0,o.kt)("inlineCode",{parentName:"p"},"sanctum")," kh\xf4ng ph\u1ea3i l\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"defaults.guard")," th\xec khi b\u1ea1n s\u1eed d\u1ee5ng h\xe0m ",(0,o.kt)("inlineCode",{parentName:"p"},"auth()")," c\u1ea7n explicit guard l\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"sanctum"),":"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-php"},"auth('sanctum')->user();\n")))),(0,o.kt)("h3",{id:"th\xeam-login-mutation"},"Th\xeam login mutation"),(0,o.kt)("p",null,"B\u1ea1n c\u1ea7n th\xeam GraphQL login mutation \u0111\u1ec3 user c\xf3 th\u1ec3 \u0111\u0103ng nh\u1eadp l\u1ea5y token s\u1eed d\u1ee5ng cho c\xe1c phi\xean sau, ch\xfang ta s\u1ebd s\u1eed d\u1ee5ng\n",(0,o.kt)("a",{parentName:"p",href:"/vi/handle-business-logic/remote-schema"},"remote schema")," \u0111\u1ec3 th\xeam login mutation."),(0,o.kt)("p",null,"V\xed d\u1ee5 login mutation resolver:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Http/GraphQL/LoginMutation/Resolver.php"',title:'"app/Http/GraphQL/LoginMutation/Resolver.php"'},"<?php\n\nnamespace App\\Http\\GraphQL\\LoginMutation;\n\nuse App\\Models\\User;\nuse Hasura\\GraphQLiteBridge\\Attribute\\Roles;\nuse Hasura\\Laravel\\GraphQLite\\Attribute\\ArgModel;\nuse Illuminate\\Support\\Facades\\Hash;\nuse TheCodingMachine\\GraphQLite\\Annotations as GQL;\nuse TheCodingMachine\\GraphQLite\\Exceptions\\GraphQLException;\nuse TheCodingMachine\\GraphQLite\\Laravel\\Annotations\\Validate;\n\nclass Resolver\n{\n    #[GQL\\Mutation(name: 'login')]\n    #[ArgModel(for: 'user', argName: 'email', fieldName: 'email', inputType: 'String!')]\n    #[Roles('anonymous')]\n    public function __invoke(\n        User $user,\n        #[Validate(['rule' => 'required'])] string $password,\n        #[Validate(['rule' => 'required'])] string $device\n    ): Output {\n        if (!Hash::check($password, $user->getAuthPassword())) {\n            throw new GraphQLException('Invalid credentials', category: 'InvalidCredentials');\n        }\n\n        $output = new Output();\n        $output->token = $user->createToken($device)->plainTextToken;\n\n        return $output;\n    }\n}\n")),(0,o.kt)("p",null,"V\xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"Output")," type class:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Http/GraphQL/LoginMutation/Output.php"',title:'"app/Http/GraphQL/LoginMutation/Output.php"'},"<?php\n\nnamespace App\\Http\\GraphQL\\LoginMutation;\n\nuse TheCodingMachine\\GraphQLite\\Annotations as GQL;\n\n#[GQL\\Type(name: 'login_output', default: true)]\nclass Output\n{\n    #[GQL\\Field]\n    public string $token;\n}\n")),(0,o.kt)("p",null,"Sau khi th\xeam b\u1ea1n h\xe3y ",(0,o.kt)("a",{parentName:"p",href:"/vi/manage-metadata/persist-application-state-metadata"},"persist application state")," v\xe0 h\xe3y th\u1eed \u0111\u0103ng nh\u1eadp v\u1edbi k\u1ebft qu\u1ea3 mong \u0111\u1ee3i s\u1ebd l\xe0:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Sanctum authentication result",src:n(6560).Z})))}h.isMDXComponent=!0},6560:function(t,a,n){a.Z=n.p+"assets/images/sanctum-authentication-result-5b7fce85cef2edaf91f7f1a11bc4b1ad.png"}}]);