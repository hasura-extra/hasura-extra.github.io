"use strict";(self.webpackChunkhasura_extra_github_io=self.webpackChunkhasura_extra_github_io||[]).push([[705],{8215:function(e,a,t){var n=t(7294);a.Z=function(e){var a=e.children,t=e.hidden,r=e.className;return n.createElement("div",{role:"tabpanel",hidden:t,className:r},a)}},6396:function(e,a,t){t.d(a,{Z:function(){return m}});var n=t(7462),r=t(7294),s=t(2389),i=t(9443);var l=function(){var e=(0,r.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},o=t(9521),u=t(6010),p="tabItem_vU9c";function c(e){var a,t,n,s=e.lazy,i=e.block,c=e.defaultValue,m=e.values,h=e.groupId,d=e.className,g=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=m?m:g.map((function(e){var a=e.props;return{value:a.value,label:a.label}})),v=(0,o.lx)(f,(function(e,a){return e.value===a.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===c?c:null!=(a=null!=c?c:null==(t=g.find((function(e){return e.props.default})))?void 0:t.props.value)?a:null==(n=g[0])?void 0:n.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var k=l(),y=k.tabGroupChoices,N=k.setTabGroupChoices,_=(0,r.useState)(b),L=_[0],T=_[1],w=[],A=(0,o.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var R=y[h];null!=R&&R!==L&&f.some((function(e){return e.value===R}))&&T(R)}var E=function(e){var a=e.currentTarget,t=w.indexOf(a),n=f[t].value;n!==L&&(A(a),T(n),null!=h&&N(h,n))},H=function(e){var a,t=null;switch(e.key){case"ArrowRight":var n=w.indexOf(e.currentTarget)+1;t=w[n]||w[0];break;case"ArrowLeft":var r=w.indexOf(e.currentTarget)-1;t=w[r]||w[w.length-1]}null==(a=t)||a.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":i},d)},f.map((function(e){var a=e.value,t=e.label;return r.createElement("li",{role:"tab",tabIndex:L===a?0:-1,"aria-selected":L===a,className:(0,u.Z)("tabs__item",p,{"tabs__item--active":L===a}),key:a,ref:function(e){return w.push(e)},onKeyDown:H,onFocus:E,onClick:E},null!=t?t:a)}))),s?(0,r.cloneElement)(g.filter((function(e){return e.props.value===L}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},g.map((function(e,a){return(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==L})}))))}function m(e){var a=(0,s.Z)();return r.createElement(c,(0,n.Z)({key:String(a)},e))}},4134:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return u},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return m},default:function(){return d}});var n=t(7462),r=t(3366),s=(t(7294),t(3905)),i=t(6396),l=t(8215),o=["components"],u={id:"persist-application-state-metadata",title:"Persist application state",sidebar_label:"Persist application state"},p=void 0,c={unversionedId:"manage-metadata/persist-application-state-metadata",id:"manage-metadata/persist-application-state-metadata",isDocsHomePage:!1,title:"Persist application state",description:"Persist application state) s\u1ebd gi\xfap vi\u1ec7c \u0111\u1ed3ng b\u1ed9 c\u1ea5u h\xecnh gi\u1eefa application",source:"@site/i18n/vi/docusaurus-plugin-content-docs/current/07-manage-metadata/07-persist-application-state.mdx",sourceDirName:"07-manage-metadata",slug:"/manage-metadata/persist-application-state-metadata",permalink:"/vi/manage-metadata/persist-application-state-metadata",editUrl:"https://github.com/hasura-extra/hasura-extra/edit/main/docusaurus/i18n/vi/docusaurus-plugin-content-docs/current/07-manage-metadata/07-persist-application-state.mdx",tags:[],version:"current",lastUpdatedBy:"Minh Vuong",lastUpdatedAt:1638641209,formattedLastUpdatedAt:"4/12/2021",sidebarPosition:7,frontMatter:{id:"persist-application-state-metadata",title:"Persist application state",sidebar_label:"Persist application state"},sidebar:"main",previous:{title:"Clear metadata",permalink:"/vi/manage-metadata/clear-metadata"},next:{title:"State processor",permalink:"/vi/manage-metadata/state-processor-metadata"}},m=[{value:"C\xe1ch th\u1ee9c ho\u1ea1t \u0111\u1ed9ng",id:"c\xe1ch-th\u1ee9c-ho\u1ea1t-\u0111\u1ed9ng",children:[],level:2}],h={toc:m};function d(e){var a=e.components,u=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,n.Z)({},h,u,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Persist application ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/State_(computer_science)"},"state")," s\u1ebd gi\xfap vi\u1ec7c \u0111\u1ed3ng b\u1ed9 c\u1ea5u h\xecnh gi\u1eefa application\nc\u1ee7a b\u1ea1n v\u1edbi Hasura metadata (v\xed d\u1ee5: remote schema permissions roles, inherited roles, remote schema SDL), vi\u1ec7c \u0111\u1ed3ng b\u1ed9 n\xe0y s\u1ebd gi\xfap\n\u0111\u1ea3m b\u1ea3o t\xednh consistent gi\u1eefa application v\u1edbi Hasura."),(0,s.kt)("p",null,"\u0110\u1ec3 persist application state b\u1ea1n c\u1ea7n th\u1ef1c thi command sau:"),(0,s.kt)(i.Z,{groupId:"frameworks",defaultValue:"laravel",values:[{label:"\u0110\u1ed1i v\u1edbi Laravel users",value:"laravel"},{label:"\u0110\u1ed1i v\u1edbi Symfony users",value:"symfony"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"laravel",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"php artisan hasura:metadata:persist-state\n")),(0,s.kt)("p",null,"Command tr\xean s\u1ebd persist application state gi\xfap b\u1ea1n.")),(0,s.kt)(l.Z,{value:"symfony",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"php bin/console hasura:metadata:persist-state\n")),(0,s.kt)("p",null,"Command tr\xean s\u1ebd persist application state gi\xfap b\u1ea1n."))),(0,s.kt)("h2",{id:"c\xe1ch-th\u1ee9c-ho\u1ea1t-\u0111\u1ed9ng"},"C\xe1ch th\u1ee9c ho\u1ea1t \u0111\u1ed9ng"),(0,s.kt)(i.Z,{groupId:"frameworks",defaultValue:"laravel",values:[{label:"\u0110\u1ed1i v\u1edbi Laravel framework",value:"laravel"},{label:"\u0110\u1ed1i v\u1edbi Symfony framework",value:"symfony"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"laravel",mdxType:"TabItem"},(0,s.kt)("p",null,"Gi\u1ea3 s\u1eed nh\u01b0 application c\u1ee7a b\u1ea1n c\xf3 mutation field ",(0,s.kt)("inlineCode",{parentName:"p"},"registration")," d\xe0nh cho ",(0,s.kt)("inlineCode",{parentName:"p"},"anonymous")," nh\u01b0 sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Http/GraphQL/RegistrationMutation/Resolver.php"',title:'"app/Http/GraphQL/RegistrationMutation/Resolver.php"'},"namespace App\\Http\\GraphQL\\RegistrationMutation;\n\nuse App\\Models\\User;\nuse Hasura\\GraphQLiteBridge\\Attribute\\Roles;\nuse Hasura\\Laravel\\GraphQLite\\Attribute\\ValidateObject;\nuse Illuminate\\Support\\Facades\\Hash;\nuse TheCodingMachine\\GraphQLite\\Annotations as GQL;\n\nclass Resolver\n{\n    #[GQL\\Mutation(name: 'registration', outputType: 'registration_output')]\n    #[ValidateObject(for: 'input')]\n    #[Roles('anonymous')]\n    public function __invoke(Input $input): User\n    {\n        $user = new User();\n        $user->name = $input->name;\n        $user->email = $input->email;\n        $user->password = Hash::make($input->password);\n        $user->saveOrFail();\n\n        return $user;\n    }\n}\n")),(0,s.kt)("p",null,"v\xe0 ",(0,s.kt)("a",{parentName:"p",href:"/vi/security/laravel-access-control#inherited-roles"},"inherited roles")," nh\u01b0 sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/hasura.php"',title:'"config/hasura.php"'},"'auth' => [\n    'inherited_roles' => [\n        'admin' => ['manager', 'user'],\n        'manager' => ['user']\n    ],\n]\n")),(0,s.kt)("p",null,"\u0110\u1ec3 persist c\xe1c application state tr\xean l\xean Hasura metadata th\xec b\u1ea1n c\u1ea7n th\u1ef1c thi Artisan console command sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"php artisan hasura:metadata:persist-state\n")),(0,s.kt)("p",null,"Sau khi persist xong ngay b\xe2y gi\u1edd b\u1ea1n h\xe3y th\u1eed ki\u1ec3m tra l\u1ea1i application ",(0,s.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/remote-schemas/auth/remote-schema-permissions.html"},"remote schema permissions")," tr\xean Hasura s\u1ebd th\u1ea5y k\u1ebft qu\u1ea3 sau:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"remote schema permissions",src:t(7014).Z})),(0,s.kt)("p",null,"V\xe0 ti\u1ebfp \u0111\u1ebfn h\xe3y th\u1eed ki\u1ec3m tra ",(0,s.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/auth/authorization/inherited-roles.html"},"inherited roles")," tr\xean Hasura s\u1ebd th\u1ea5y k\u1ebft qu\u1ea3 sau:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"inherited roles",src:t(2373).Z})),(0,s.kt)("p",null,"V\u1eady l\xe0 b\u1ea1n \u0111\xe3 ho\xe0n t\u1ea5t vi\u1ec7c persist application state l\xean Hasura r\u1ed3i \u0111\u1ea5y.")),(0,s.kt)(l.Z,{value:"symfony",mdxType:"TabItem"},(0,s.kt)("p",null,"Gi\u1ea3 s\u1eed nh\u01b0 application c\u1ee7a b\u1ea1n c\xf3 mutation field ",(0,s.kt)("inlineCode",{parentName:"p"},"user_registration")," d\xe0nh cho ",(0,s.kt)("inlineCode",{parentName:"p"},"ROLE_ANONYMOUS")," nh\u01b0 sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="src/GraphQL/User/RegistrationMutation/Resolver.php"',title:'"src/GraphQL/User/RegistrationMutation/Resolver.php"'},"namespace App\\GraphQL\\User\\RegistrationMutation;\n\nuse App\\Entity\\User;\nuse App\\Security\\SystemRoles;\nuse Hasura\\Bundle\\GraphQLite\\Attribute\\ObjectAssertion;\nuse Hasura\\Bundle\\GraphQLite\\Attribute\\Transactional;\nuse Hasura\\GraphQLiteBridge\\Attribute\\ArgNaming;\nuse Hasura\\GraphQLiteBridge\\Attribute\\Roles;\nuse Symfony\\Component\\PasswordHasher\\Hasher\\UserPasswordHasherInterface;\nuse TheCodingMachine\\GraphQLite\\Annotations as GQL;\n\nfinal class Resolver\n{\n    public function __construct(private UserPasswordHasherInterface $hasher)\n    {\n    }\n\n    #[GQL\\Mutation(name: 'user_registration', outputType: 'user_registration_mutation_output!')]\n    #[Roles(SystemRoles::ROLE_ANONYMOUS)]\n    #[ArgNaming(for: 'inputObj', name: 'input_obj')]\n    #[ObjectAssertion(for: 'inputObj')]\n    #[Transactional]\n    public function __invoke(Input $inputObj): User\n    {\n        $user = new User();\n        $user->setName($inputObj->name);\n        $user->setEmail($inputObj->email);\n        $user->setPassword($this->hasher->hashPassword($user, $inputObj->password));\n\n        return $user;\n    }\n}\n")),(0,s.kt)("p",null,"v\xe0 ",(0,s.kt)("a",{parentName:"p",href:"https://symfony.com/doc/current/security.html#hierarchical-roles"},"role hierarchy")," nh\u01b0 sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/packages/security.yaml"',title:'"config/packages/security.yaml"'},"role_hierarchy:\n    ROLE_ADMIN:       ROLE_USER\n    ROLE_SUPER_ADMIN: [ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH]\n")),(0,s.kt)("p",null,"\u0110\u1ec3 persist c\xe1c application state tr\xean l\xean Hasura metadata th\xec b\u1ea1n c\u1ea7n th\u1ef1c thi Symfony console command sau:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"php bin/console hasura:metadata:persist-state\n")),(0,s.kt)("p",null,"Sau khi persist xong ngay b\xe2y gi\u1edd b\u1ea1n h\xe3y th\u1eed ki\u1ec3m tra l\u1ea1i application ",(0,s.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/remote-schemas/auth/remote-schema-permissions.html"},"remote schema permissions")," tr\xean Hasura s\u1ebd th\u1ea5y k\u1ebft qu\u1ea3 sau:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"remote schema permissions",src:t(2876).Z})),(0,s.kt)("p",null,"V\xe0 ti\u1ebfp \u0111\u1ebfn h\xe3y th\u1eed ki\u1ec3m tra ",(0,s.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/auth/authorization/inherited-roles.html"},"inherited roles")," tr\xean Hasura s\u1ebd th\u1ea5y k\u1ebft qu\u1ea3 sau:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"inherited roles",src:t(5166).Z})),(0,s.kt)("p",null,"V\u1eady l\xe0 b\u1ea1n \u0111\xe3 ho\xe0n t\u1ea5t vi\u1ec7c persist application state l\xean Hasura r\u1ed3i \u0111\u1ea5y."))))}d.isMDXComponent=!0},2373:function(e,a,t){a.Z=t.p+"assets/images/laravel-inherited-roles-3971ff408e43c4798f3d2b28ef03ce87.png"},7014:function(e,a,t){a.Z=t.p+"assets/images/laravel-remote-schema-permissions-6eff0463ba2947e4fb28e5d5148b31db.png"},5166:function(e,a,t){a.Z=t.p+"assets/images/symfony-inherited-roles-79f287f8161c9283697ab4c3ff2c5160.png"},2876:function(e,a,t){a.Z=t.p+"assets/images/symfony-remote-schema-permissions-c4f777786b46908926036b7b045046c5.png"}}]);