<!doctype html>
<html class="docs-version-current" lang="vi" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Symfony JWT authentication | Hasura Extra</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://hasura-extra.github.io/vi/img/logo-text.png"><meta data-react-helmet="true" name="twitter:image" content="https://hasura-extra.github.io/vi/img/logo-text.png"><meta data-react-helmet="true" property="og:url" content="https://hasura-extra.github.io/vi/security/symfony-jwt-authentication"><meta data-react-helmet="true" name="docusaurus_locale" content="vi"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Symfony JWT authentication | Hasura Extra"><meta data-react-helmet="true" name="description" content="Tài liệu này chỉ dành cho Symfony users sử dụng webhook authentication."><meta data-react-helmet="true" property="og:description" content="Tài liệu này chỉ dành cho Symfony users sử dụng webhook authentication."><link data-react-helmet="true" rel="shortcut icon" href="/vi/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hasura-extra.github.io/vi/security/symfony-jwt-authentication"><link data-react-helmet="true" rel="alternate" href="https://hasura-extra.github.io/security/symfony-jwt-authentication" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hasura-extra.github.io/vi/security/symfony-jwt-authentication" hreflang="vi"><link data-react-helmet="true" rel="alternate" href="https://hasura-extra.github.io/security/symfony-jwt-authentication" hreflang="x-default"><link rel="stylesheet" href="/vi/assets/css/styles.94743332.css">
<link rel="preload" href="/vi/assets/js/runtime~main.6ef248e6.js" as="script">
<link rel="preload" href="/vi/assets/js/main.87ebc227.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Nhảy tới nội dung</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vi/"><div class="navbar__logo"><img src="/vi/img/logo.png" alt="Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/vi/img/logo.png" alt="Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Hasura Extra</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Tiếng Việt</span></span></a><ul class="dropdown__menu"><li><a href="/security/symfony-jwt-authentication" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/vi/security/symfony-jwt-authentication" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">Tiếng Việt</a></li></ul></div><a href="https://github.com/hasura-extra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Trở lại đầu trang" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vi/">Giới thiệu</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cài đặt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Handle business logic</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Security</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/security/webhook-authentication">Webhook authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/security/session-variable-enhancer">Session variable enhancer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/security/unauthenticated-role">Unauthenticated role</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/security/laravel-access-control">Laravel access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/security/laravel-sanctum-authentication">Laravel Sanctum authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/vi/security/symfony-jwt-authentication">Symfony JWT authentication</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Code generation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Manage metadata</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">Trên trang này</button></div><div class="theme-doc-markdown markdown"><header><h1>Symfony JWT authentication</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Tài liệu này chỉ dành cho Symfony users sử dụng <a href="/vi/security/webhook-authentication">webhook authentication</a>.</p></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nếu như project của bạn sử dụng <a href="/vi/installation/application-templates">Symfony app</a>, template đã setup mọi thứ giúp bạn,
bạn không cần làm theo các bước bên dưới mà chỉ nên đọc để hiểu cơ chế hoạt động của nó như thế nào.</p></div></div><p>Hasura Extra webhook mode có thể dễ dàng tích hợp <a href="https://jwt.io" target="_blank" rel="noopener noreferrer">JWT</a> authentication thông qua <a href="https://github.com/lexik/LexikJWTAuthenticationBundle" target="_blank" rel="noopener noreferrer">Lexik JWT authentication bundle</a>
và <a href="https://hasura.io/docs/latest/graphql/core/actions/index.html" target="_blank" rel="noopener noreferrer">Hasura action</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cài-đặt-lexik-jwt-authentication">Cài đặt Lexik JWT authentication<a aria-hidden="true" class="hash-link" href="#cài-đặt-lexik-jwt-authentication" title="Đường dẫn trực tiếp tới đề mục này">​</a></h2><p>Cài đặt thông qua Composer:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">composer</span><span class="token plain"> require jwt</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>Sau khi cài xong bạn cần khởi tạo set public/private keys thông qua <a href="https://github.com/lexik/LexikJWTAuthenticationBundle/blob/2.x/Resources/doc/index.md#generate-the-ssl-keys" target="_blank" rel="noopener noreferrer">command được cung cấp bởi bundle</a>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">php bin/console lexik:jwt:generate-keypair</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>public/private keys sẽ được sinh ra trong thư mục <code>config/jwt</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cấu-hình-security-bundle">Cấu hình security bundle<a aria-hidden="true" class="hash-link" href="#cấu-hình-security-bundle" title="Đường dẫn trực tiếp tới đề mục này">​</a></h2><p>Bạn cần cấu hình security main firewall (<code>config/packages/security.yaml</code>) cho webhook endpoint và <a href="/vi/handle-business-logic/graphql-server/graphqlite">GraphQLite</a> endpoint,
ví dụ:</p><div class="codeBlockContainer_J+bg"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">config/packages/security.yaml</div><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">security</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enable_authenticator_manager</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">providers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">entity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">class</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> App\Entity\User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">property</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">firewalls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">main</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">stateless</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># https://github.com/lexik/LexikJWTAuthenticationBundle/blob/2.x/Resources/doc/index.md#configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">jwt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null important">~</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">json_login</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">check_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">success_handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lexik_jwt_authentication.handler.authentication_success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">failure_handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lexik_jwt_authentication.handler.authentication_failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">entry_point</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jwt</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>Theo ví dụ trên tất cả request đi vào system của bạn đều được security bundle authenticate, tiếp đến bạn cần add route mock <code>/login</code>,
khởi tạo file <code>config/routes/login.yaml</code> với nội dung sau:</p><div class="codeBlockContainer_J+bg"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">config/routes/login.yaml</div><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">login</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">methods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>Như bạn thấy route trên không có controller, mục đích chỉ để định danh cho <code>json_login</code> ở trên.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="listen-authentication-failure-event">Listen authentication failure event<a aria-hidden="true" class="hash-link" href="#listen-authentication-failure-event" title="Đường dẫn trực tiếp tới đề mục này">​</a></h2><p>Bạn cần tạo một subscriber/listener để listen authentication failure event nhằm <a href="https://hasura.io/docs/latest/graphql/core/actions/action-handlers.html#returning-an-error-response" target="_blank" rel="noopener noreferrer">format response payload theo yêu cầu của Hasura action</a>.</p><p>Ví dụ:</p><div class="codeBlockContainer_J+bg"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">src/EventSubscriber/Authentication/AuthenticationFailureSubscriber.php</div><div class="codeBlockContent_csEI php"><pre tabindex="0" class="prism-code language-php codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">declare(strict_types=1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\EventSubscriber\Authentication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Lexik\Bundle\JWTAuthenticationBundle\Event\AuthenticationFailureEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Lexik\Bundle\JWTAuthenticationBundle\Events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Lexik\Bundle\JWTAuthenticationBundle\Response\JWTAuthenticationFailureResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Symfony\Component\EventDispatcher\EventSubscriberInterface;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Symfony\Component\HttpFoundation\JsonResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">final class AuthenticationFailureSubscriber implements EventSubscriberInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function getSubscribedEvents()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Events::AUTHENTICATION_FAILURE =&gt; [&#x27;onAuthenticationFailure&#x27;, -8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function onAuthenticationFailure(AuthenticationFailureEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $response = $event-&gt;getResponse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($response instanceof JWTAuthenticationFailureResponse) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Set response compatible with Hasura action.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // https://hasura.io/docs/latest/graphql/core/actions/action-handlers.html#returning-an-error-response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $event-&gt;setResponse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new JsonResponse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &#x27;extensions&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &#x27;category&#x27; =&gt; &#x27;security&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &#x27;message&#x27; =&gt; $response-&gt;getMessage()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    $response-&gt;getStatusCode()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>Vậy là bạn đã chuẩn bị xong ở application rồi đấy, tiếp đến hãy <a href="#action-login-on-hasura">config action login trên Hasura</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="action-login-on-hasura">Thêm action login trên Hasura<a aria-hidden="true" class="hash-link" href="#action-login-on-hasura" title="Đường dẫn trực tiếp tới đề mục này">​</a></h2><p><a href="https://hasura.io/docs/latest/graphql/core/actions/index.html" target="_blank" rel="noopener noreferrer">Hasura action</a> cũng là nơi để handle business logic, chúng ta
sẽ sử dụng nó để add login mutation field.</p><p>Bạn hãy thiết lập action definition như sau:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI GraphQL"><pre tabindex="0" class="prism-code language-GraphQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">type Mutation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  login(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email: String!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: String!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): login_output!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p>Và type configuration như sau:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">login_output</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p><img alt="add action login" src="/vi/assets/images/jwt-authentication-action-login-bf6a82ca51932288b34054ec24991685.png"></p><p>Execution type bạn sẽ chọn là: <code>Synchronous</code>.</p><p>Tiếp đến ta sẽ config <a href="https://hasura.io/docs/latest/graphql/core/actions/transforms.html#request-body" target="_blank" rel="noopener noreferrer">payload transform</a> để format payload về
chuẩn của login request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$body.input.email</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;password&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$body.input.password</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Sao chép code vào bộ nhớ tạm" class="copyButton_M3SB clean-btn">Sao chép</button></div></div><p><img alt="body transform" src="/vi/assets/images/jwt-authentication-action-login-body-transform-93045a0e23519ea2689470c22bb4f527.png"></p><p>Save lại và giờ bạn đã có thể test login thử, kết quả mong đợi sẽ là:</p><p><img alt="result" src="/vi/assets/images/jwt-authentication-result-bf219543e9370e8809d6642a56b24325.png"></p><p>Vậy là bạn đã hoàn tất việc thiết lập JWT authentication rồi đấy.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hasura-extra/hasura-extra/edit/main/docusaurus/i18n/vi/docusaurus-plugin-content-docs/current/05-security/06-symfony-jwt-authentication.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Sửa trang này</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Cập nhật lần cuối <!-- --> vào <b><time datetime="2021-12-04T18:06:49.000Z">4/12/2021</time></b> bởi <!-- --> bởi <b>Minh Vuong</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Thanh điều hướng của trang tài liệu"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/vi/security/laravel-sanctum-authentication"><div class="pagination-nav__sublabel">Trước</div><div class="pagination-nav__label">« <!-- -->Laravel Sanctum authentication</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/vi/code-generation/client-query-generator"><div class="pagination-nav__sublabel">Kế tiếp</div><div class="pagination-nav__label">Client query generator<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cài-đặt-lexik-jwt-authentication" class="table-of-contents__link toc-highlight">Cài đặt Lexik JWT authentication</a></li><li><a href="#cấu-hình-security-bundle" class="table-of-contents__link toc-highlight">Cấu hình security bundle</a></li><li><a href="#listen-authentication-failure-event" class="table-of-contents__link toc-highlight">Listen authentication failure event</a></li><li><a href="#action-login-on-hasura" class="table-of-contents__link toc-highlight">Thêm action login trên Hasura</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/vi/"><img src="/vi/img/logo-text.png" alt="" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/vi/img/logo-text.png" alt="" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 <a href="https://github.com/vuongxuongminh/">Minh Vuong.</a></div></div></div></footer></div>
<script src="/vi/assets/js/runtime~main.6ef248e6.js"></script>
<script src="/vi/assets/js/main.87ebc227.js"></script>
</body>
</html>